# Gemini.md - Progressive Disclosure Edition

```
<!-- BD_PROTOCOL_START -->
# BeadsLog Agent Protocol

## ğŸš€ Session Start? (First Message Only)
IF this is your first message:
1. Read: _rules/_orchestration/PROTOCOL.md  
2. Execute: Beads + Devlog starting workflows
3. Proceed to regular workflow

## ğŸ”„ Regular Workflow (Every Task)
Read: _rules/_orchestration/WORKING_PROTOCOL.md

## ğŸ“‹ Core Commands (Always Available)

### Beads (Issues)
bd ready                 # Find next task
bd update <id>           # Mark in progress  
bd close <id>            # Complete task
bd sync                  # Sync issues (auto via git hook)

### Devlog (Memory)
bd devlog resume --last 1    # Load last session
bd devlog search "query"     # Find past solutions
bd devlog graph "entity"     # See dependencies
bd devlog impact "entity"    # What depends on this?

### Commit (Auto-Devlog)
git commit -m "fix: message" # Generates devlog automatically

## ğŸ” Discover More
bd --help                 # All bd commands
bd devlog --help          # All devlog commands

## ğŸ“š On-Demand Files (Load Only When Needed)
| File | When to Load |
|------|-------------|
| **PROTOCOL.md** | First execution only |
| **WORKING_PROTOCOL.md** | Every task |
| **BEADS_REFERENCE.md** | bd --help insufficient |
| **DEVLOG_REFERENCE.md** | bd devlog --help insufficient |
| **OVERVIEW.md** | Need project overview/architecture |
| **PROJECT_KNOWLEDGE.md** | Conventions/testing details |

## âš ï¸ Loading Rules
1. Always try --help first
2. Load PROTOCOL.md only once per session
3. Load WORKING_PROTOCOL.md at task start
4. Reference files only when commands fail
<!-- BD_PROTOCOL_END -->
```

***

## ğŸ“ Folder Structure

```
_rules/_orchestration/
â”œâ”€â”€ PROTOCOL.md              # First session only (onboarding)
â”œâ”€â”€ WORKING_PROTOCOL.md      # Every task (the loop)
â”œâ”€â”€ BEADS_REFERENCE.md       # Full bd commands (on-demand)
â”œâ”€â”€ DEVLOG_REFERENCE.md      # Full bd devlog commands (on-demand)
â”œâ”€â”€ OVERVIEW.md              # Project overview (generated by bd init)
â””â”€â”€ PROJECT_KNOWLEDGE.md     # Architecture/conventions (manual)
```

***

## ğŸ“„ PROTOCOL.md (First Session Only)

```
# Protocol: First Execution

âš ï¸ **Load ONLY on first message per session**

## 1. Beads Starting Workflow
[codeblock=bash]
bd sync          # Get latest issues
bd status        # Health check
bd ready         # Find prioritized work
[/codeblock]

## 2. Devlog Starting Workflow
[codeblock=bash]
bd devlog sync   # Get latest team knowledge
bd devlog resume --last 1  # Load your last session
bd devlog status # Devlog health
[/codeblock]

## 3. Pick Task
- Choose from `bd ready`
- `bd update <id>` to claim
- Check: `bd devlog search "<issue keywords>"`

## âœ… Now Ready
Load WORKING_PROTOCOL.md for task loop.
```

***

## ğŸ“„ WORKING_PROTOCOL.md (Every Task)

```
# Working Protocol

âš ï¸ **Load for every task during active work**

## ğŸ”„ The Loop (Repeat)

### Before Coding
[codeblock=bash]
bd devlog graph "ComponentName"  # Dependencies
bd devlog impact "ComponentName" # What breaks if changed?
bd devlog search "error/feature" # Past solutions?
[/codeblock]

### Code + Commit (Auto-Devlog)
[codeblock=bash]
git add .
git commit -m "fix: descriptive message"
[/codeblock]
*Pre-commit automatically generates devlog*

### Update Issue
[codeblock=bash]
bd update <id> --status "in-progress" | closed
[/codeblock]

## ğŸ†˜ Common Scenarios
**Split work?** `bd split <id> "sub-task"`
**Blocked?** `bd block <current> <blocking>`
**New bug?** `bd new "Bug title" --priority high`

## âœ… End Session
[codeblock=bash]
bd status          # Verify sync
git push           # Share with team
[/codeblock]

## ğŸ” Still Need Help?
bd --help | bd devlog --help â†’ Load *_REFERENCE.md
```

***

## ğŸ“„ BEADS_REFERENCE.md (On-Demand)

```
# Beads Commands

âš ï¸ **Load ONLY when bd --help insufficient**

## Issue Lifecycle
[codeblock=bash]
bd new "Title" --type bug --priority high
bd ready                           # P0 issues
bd update <id> --status in-progress
bd update <id> --assign @teammate
bd close <id>
bd split <id> "Sub-task"
bd block <current> <blocking>
[/codeblock]

## Query
[codeblock=bash]
bd list --status open
bd show <id>
bd search "keywords"
[/codeblock]

[Full details...]
```

***

## ğŸ“„ DEVLOG_REFERENCE.md (On-Demand)

```
# Devlog Commands

âš ï¸ **Load ONLY when bd devlog --help insufficient**

## Search
[codeblock=bash]
bd devlog search "nginx timeout"
bd devlog search "modal" --type fix
bd devlog search "auth" --since 2026-01
bd devlog list --last 5
[/codeblock]

## Architecture
[codeblock=bash]
bd devlog graph "nginx"
bd devlog impact "AuthService"
bd devlog status
bd devlog verify --fix
[/codeblock]

[Full details...]
```

***

## ğŸ“„ OVERVIEW.md (Project Overview)

```
# Project Overview

âš ï¸ **Load for general project understanding**

## Architecture
- Frontend: React + Shadcn UI + TypeScript
- Backend: Go + PostgreSQL
- Deployment: Cloudron + Docker multi-arch
- Auth: JWT + database tokens

## Key Components
[codeblock]
managecolumnsmodal â†’ useSortable â†’ @dnd-kit
nginx â†’ cloudron â†’ mcp-sse-transport
schema-cache â†’ insert_row â†’ update_row
[/codeblock]

## Conventions
- Modals: admin-ui-shadcn/src/components/modals/
- Services: CamelCaseService pattern
- Hooks: useCamelCaseHook

Generated by: bd init (updated on repo changes)
```

***

## ğŸ“„ PROJECT_KNOWLEDGE.md (Task-Specific)

```
# Project Knowledge

âš ï¸ **Load for conventions/testing/architecture**

## Testing
[codeblock=bash]
npm test
go test ./...
docker buildx build --platform linux/arm64,linux/amd64 .
[/codeblock]

## Naming
- Components: ManageColumnsModal.tsx
- Services: authService, schemaCacheService
- Files: snake_case for config, CamelCase for components

## Deployment
[codeblock=bash]
bd deploy staging
bd deploy production --confirm
[/codeblock]

[Full project details...]
```

***

## ğŸ¯ Agent Loading Logic

### **In AGENT_INSTRUCTIONS.md** (Explicit Conditionals)

```
## ğŸ”„ Loading Rules (MANDATORY)

**IF** first message in conversation:
1. Load: _rules/_orchestration/PROTOCOL.md
2. Execute workflows
3. Load: _rules/_orchestration/WORKING_PROTOCOL.md

**IF** continuing existing task:
1. Load: _rules/_orchestration/WORKING_PROTOCOL.md
2. Execute loop

**IF** `bd` command unclear:
1. `bd --help` first
2. Load: _rules/_orchestration/BEADS_REFERENCE.md

**IF** `bd devlog` command unclear:
1. `bd devlog --help` first  
2. Load: _rules/_orchestration/DEVLOG_REFERENCE.md

**IF** need project context:
1. Load: _rules/_orchestration/OVERVIEW.md
2. Load: _rules/_orchestration/PROJECT_KNOWLEDGE.md (if still needed)

## âš ï¸ NEVER load reference files unless explicitly needed
```

***

## ğŸ“Š Token Efficiency

| Scenario | Files Loaded | Tokens |
|----------|-------------|--------|
| **New session** | Instructions + PROTOCOL + WORKING_PROTOCOL | ~900 |
| **Regular task** | Instructions + WORKING_PROTOCOL | ~500 |
| **Command confusion** | Instructions + WORKING_PROTOCOL + BEADS_REFERENCE | ~1300 |
| **Current (monolithic)** | Everything | ~3000 |

**Savings:** 70% average reduction.

***

## ğŸ¯ Why This Works

1. **Commands first** â†’ Agents see `bd devlog search` immediately
2. **Conditional loading** â†’ Only load what's needed
3. **Explicit triggers** â†’ Agent knows exactly when to load each file
4. **--help discovery** â†’ Encourages tool exploration [code.claude](https://code.claude.com/docs/en/skills)
5. **Hub-and-spoke** â†’ Central instructions, satellite details

**Matches:**
- âœ… Anthropic progressive disclosure [mcpjam](https://www.mcpjam.com/blog/claude-agent-skills)
- âœ… Beads minimalism [github](https://github.com/steveyegge/beads/blob/main/AGENT_INSTRUCTIONS.md)
- âœ… Manus one-action-per-turn [gist.github](https://gist.github.com/renschni/4fbc70b31bad8dd57f3370239dccd58f)

Perfect balance of guidance + discovery! ğŸ¯
