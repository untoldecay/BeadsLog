#!/usr/bin/env sh
# bd-shim v1
# bd-hooks-version: 0.47.0
#
# bd (beads) pre-commit hook - thin shim
#
# This shim delegates to 'bd hooks run pre-commit' which contains
# the actual hook logic. This pattern ensures hook behavior is always
# in sync with the installed bd version - no manual updates needed.

# Check if bd is available (prefer local ./bd if present)
if [ -f "./bd" ]; then
    BD_CMD="./bd"
elif command -v bd >/dev/null 2>&1; then
    BD_CMD="bd"
else
    echo "Warning: bd command not found, skipping pre-commit hook" >&2
    echo "  Install bd: brew install steveyegge/tap/bd" >&2
    exit 0
fi

# Run bd devlog compliance check
# This command exits with 1 if devlog is not compliant, blocking the commit.
if ! $BD_CMD check --hook pre-commit; then
    exit 1
fi

exec $BD_CMD hooks run pre-commit "$@"
